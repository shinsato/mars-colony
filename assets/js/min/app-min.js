!function(t,o){"use strict";t.module("app",["ngDraggable"]).controller("appController",["$scope","$interval",function(t,e){t.totalCount=0;var i=function(){this.id=0,this.x=0,this.y=0,this.z=0,this.type="living",this.capacity=4,this.colonists=[]};i.prototype.AtCapacity=function(){var e=this,i=o.reduce(t.colony.colonists,function(t,o){return o.room.id==e.id?t+1:t},0);return i>=e.capacity?!0:!1},i.prototype.AddColonist=function(t){return this.AtCapacity()?!1:(t.room=this,!0)},i.prototype.GetColonists=function(){var e=this;return o.filter(t.colony.colonists,function(t){return t.room.id==e.id?t:void 0})},t.changeRoom=function(t,o,e){e.AddColonist(t)},t.logThings=function(t){console.log(t)};var n=function(){this.gender=chance.gender(),this.name=chance.name({gender:this.gender}),this.age=o.random(15,30),this.charisma={},buildOut(this.charisma),this.strength={},buildOut(this.strength),this.intelligence={},buildOut(this.intelligence),this.endurance={},buildOut(this.endurance),this.uid=this.charisma.gene.concat(this.endurance.gene,this.strength.gene,this.intelligence.gene),this.alive=!0,this.withChild=!1,this.room=0,t.totalCount++};n.prototype.ChangeRoom=function(t){console.log("firing"),t||(this.room=t)},n.prototype.Age=function(){if(!this.alive)return!1;if(this.withChild>0&&this.withChild++,"Female"==this.gender&&this.withChild>=3){var o=this.room;if(!o.AtCapacity()){this.withChild=!1;var e=new n;e.id=t.colony.colonists.length,e.age=0,t.colony.colonists.push(e),o.AddColonist(e)}}this.age++,this.RollEndurance(),this.endurance.attr<1&&(this.alive=!1,t.totalCount--)},n.prototype.RollEndurance=function(){var t=o.random(1,10);this.age<=2||this.age>=75?t-=2:(this.age<=5||this.age>=65)&&(t-=1),1>=t&&this.endurance.attr--},n.prototype.RollStrength=function(){var t=o.random(1,10);return t+(this.strength.attr-5)},n.prototype.IsFertile=function(){return this.alive&&this.age>=18&&0==this.withChild?"Female"==this.gender&&this.age>=51?!1:!0:!1};var s=function(t,o){o=o||6,this.starterCount=o,this.name=t,this.age=0,this.alive=!0,this.colonists=[],this.couples=[],this.food=7*o,this.ore=0,this.rooms=[];var e=0,s=new i;s.id=this.rooms.length;for(var r=1;o>=r;r++){var a=new n;a.id=this.colonists.length,this.colonists.push(a),e<s.capacity?(a.room=s,e++):(this.rooms.push(s),s=new i,e=0,s.id=this.rooms.length,a.room=s,e++)}this.rooms.push(s);var l=new i;l.type="mining",l.id=this.rooms.length,this.rooms.push(l);var h=new i;h.type="farming",h.id=this.rooms.length,this.rooms.push(h)};s.prototype.Age=function(){var t=this;t.age++,t.food--,o.each(t.colonists,function(e){e.Age();var i=e.room,n=e.room.GetColonists();if("living"==i.type)o.find(n,function(t){if(e.id!=t.id&&e.IsFertile()&&t.IsFertile()&&"Female"==e.gender&&"Male"==t.gender){var i=o.random(1,6);console.log("Roll to conceive");var n=i+e.charisma.attr+t.charisma.attr;if(n>=4)return e.withChild=1,console.log("With child!"),!0}});else if("farming"==i.type){var s=e.RollStrength();s>5&&t.food++,console.log("Food Farmed",s)}else if("mining"==i.type){console.log("Mining!");var r=e.RollStrength();r>7?(t.ore++,console.log("mining success!")):r>=2?(e.endurance.attr--,console.log("Ouch.")):0===r&&(e.alive=!1,console.log("NOOOOOOOO."))}}),this.alive=o.some(t.colonists,{alive:!0})},t.onDragSucces=function(o,e,i){var n=t.draggableObjects[o],s=t.draggableObjects.indexOf(e);t.draggableObjects[o]=e,t.draggableObjects[s]=n},t.game={theLoop:!1,started:!1,colonyStarted:!1,colonyName:"OMG Why?",numColonists:6},t.beginColony=function(){t.colony=new s(t.game.colonyName,t.game.numColonists),t.game.started=!0,t.game.colonyStarted=!0,t.startColony()},t.startColony=function(){t.game.theLoop=e(function(){t.colony.Age(),t.colony.alive||(t.game.colonyStarted=!1,t.stopColony())},1e3)},t.stopColony=function(){e.cancel(t.game.theLoop),t.game.theLoop=!1},t.togglePause=function(){t.game.colonyStarted&&(t.game.theLoop!==!1?t.stopColony():t.startColony())}}]).controller("manageCrew",["$scope",function(t){}]).directive("pressSpace",function(){return function(t,o,e){o.bind("keydown keypress",function(o){32===o.which&&(t.$apply(function(){t.$eval(e.pressSpace)}),o.preventDefault())})}})}(window.angular,window._);